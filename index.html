<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–Æ–ª—è: –ú–∞–Ω–¥—Ä—ñ–≤–Ω–∏—Ü—è –º—ñ–∂ –≤—Å—Ä–∞—Ç–∏–º–∏ —Å–≤—ñ—Ç–∞–º–∏</title>
    
    <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Tailwind CSS –¥–ª—è —Å—Ç–∏–ª—ñ–∑–∞—Ü—ñ—ó -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —à—Ä–∏—Ñ—Ç—ñ–≤ –≤—ñ–¥ Google -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Press+Start+2P&display=swap" rel="stylesheet">

    <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Tone.js –¥–ª—è –∑–≤—É–∫–æ–≤–∏—Ö –µ—Ñ–µ–∫—Ç—ñ–≤ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>

    <style>
        /* –î–æ–¥–∞—î–º–æ –≤–ª–∞—Å–Ω—ñ —Å—Ç–∏–ª—ñ —Ç–∞ –∞–Ω—ñ–º–∞—Ü—ñ—ó */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* –¢–µ–º–Ω–∏–π —Ñ–æ–Ω */
            color: #F3F4F6;
            /* –í–ò–î–ê–õ–ï–ù–û: overflow: hidden; –¥–ª—è –¥–æ–∑–≤–æ–ª—É —Å–∫—Ä–æ–ª—ñ–Ω–≥—É */
        }
        .font-game {
            font-family: 'Press Start 2P', cursive;
        }
        /* –ê–Ω—ñ–º–∞—Ü—ñ—è –¥–ª—è –∫—É—Ä—Å–æ—Ä–∞ –≤ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ */
        .blinking-cursor {
            display: inline-block;
            background-color: #34D399;
            margin-left: 4px;
            width: 10px;
            animation: blink 1s step-end infinite;
        }
        @keyframes blink {
            from, to { background-color: transparent }
            50% { background-color: #34D399; }
        }
        /* –°—Ç–∏–ª—ñ–∑–∞—Ü—ñ—è –∫–Ω–æ–ø–æ–∫ –≤–∏–±–æ—Ä—É */
        .choice-btn {
            transition: all 0.2s ease-in-out;
        }
        .choice-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(236, 72, 153, 0.7);
        }
        /* –ö–ª–∞—Å –¥–ª—è –ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –µ–∫—Ä–∞–Ω—ñ–≤ */
        .hidden {
            display: none;
        }
        /* –°—Ç–∏–ª—ñ–∑–∞—Ü—ñ—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ */
        #modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 40;
        }
        #modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è HP-–±–∞—Ä—É */
        .hp-bar-container {
            width: 80%;
            max-width: 500px;
            height: 25px;
            background-color: #dc2626; /* –ß–µ—Ä–≤–æ–Ω–∏–π, —è–∫—â–æ –Ω–µ–º–∞—î HP */
            border: 2px solid #ef4444;
            border-radius: 9999px; /* Fully rounded */
            overflow: hidden;
            margin-bottom: 1.5rem; /* mb-6 */
        }
        .hp-bar-fill {
            height: 100%;
            width: 100%; /* –ü–æ—á–∞—Ç–∫–æ–≤–∞ —à–∏—Ä–∏–Ω–∞ */
            background-color: #22c55e; /* –ó–µ–ª–µ–Ω–∏–π, –ø–æ–≤–Ω–∏–π HP */
            border-radius: 9999px;
            transition: width 0.5s ease-out, background-color 0.5s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #111827; /* Dark text for readability */
            font-weight: bold;
            font-size: 0.875rem; /* text-sm */
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –∞—Ç–∞–∫–∏ –±–æ—Å–∞ (–∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è, —â–æ –∑'—è–≤–ª—è—î—Ç—å—Å—è —ñ –∑–Ω–∏–∫–∞—î) */
        #boss-attack-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain; /* –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤–º—ñ—â—É—î—Ç—å—Å—è */
            background-repeat: no-repeat;
            background-position: center;
            background-color: rgba(0, 0, 0, 0.7); /* –ù–∞–ø—ñ–≤–ø—Ä–æ–∑–æ—Ä–∏–π —Ñ–æ–Ω */
            opacity: 0;
            transition: opacity 2s ease-out; /* –ê–Ω—ñ–º–∞—Ü—ñ—è –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è, –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞ 2s */
            z-index: 30; /* –ü–æ–≤–µ—Ä—Ö –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤, –∫—Ä—ñ–º –º–æ–¥–∞–ª—å–Ω–∏—Ö –≤—ñ–∫–æ–Ω */
            display: flex; /* –î–ª—è —Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è */
            align-items: center;
            justify-content: center;
            pointer-events: none; /* –î–æ–∑–≤–æ–ª—è—î –∫–ª—ñ–∫–∞–º –ø—Ä–æ—Ö–æ–¥–∏—Ç–∏ –∫—Ä—ñ–∑—å –Ω—å–æ–≥–æ, –∫–æ–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–µ */
        }
        #boss-attack-overlay.active {
            opacity: 1; /* –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–æ–≤–Ω—ñ—Å—Ç—é –≤–∏–¥–∏–º–µ */
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –ø—ñ–¥—Å–≤—ñ—á—É–≤–∞–Ω–Ω—è —Ç–∞ –º–∏–≥–æ—Ç—ñ–Ω–Ω—è –ø–æ–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è */
        @keyframes highlight-blink {
            0% { box-shadow: 0 0 5px rgba(255, 255, 0, 0.5); border-color: #facc15; }
            50% { box-shadow: 0 0 20px rgba(255, 255, 0, 1); border-color: #facc15; }
            100% { box-shadow: 0 0 5px rgba(255, 255, 0, 0.5); border-color: #facc15; }
        }
        .highlight-blink {
            animation: highlight-blink 1.5s infinite alternate; /* 1.5s –∞–Ω—ñ–º–∞—Ü—ñ—è, –±–µ–∑–∫—ñ–Ω–µ—á–Ω–æ, —Ç—É–¥–∏-—Å—é–¥–∏ */
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è —Ä–µ–≥—É–ª—è—Ç–æ—Ä–∞ –≥—É—á–Ω–æ—Å—Ç—ñ */
        #volume-control-container {
            position: absolute;
            bottom: 1rem; /* –ó–º—ñ–Ω–µ–Ω–æ –∑ 'top' –Ω–∞ 'bottom' */
            right: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 0.5rem 0.75rem;
            border-radius: 9999px; /* Fully rounded */
            z-index: 50; /* –ü–æ–≤–µ—Ä—Ö —ñ–Ω—à–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤, –∞–ª–µ –ø—ñ–¥ –º–æ–¥–∞–ª—å–Ω–∏–º –≤—ñ–∫–Ω–æ–º */
        }
        #volume-slider {
            width: 80px;
            height: 4px; /* –¢–æ–Ω—à–∞ –ª—ñ–Ω—ñ—è */
            -webkit-appearance: none; /* –í–∏–¥–∞–ª–∏—Ç–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –≤–∏–≥–ª—è–¥ */
            background: #4B5563; /* –ö–æ–ª—ñ—Ä —Ç—Ä–µ–∫—É */
            outline: none;
            border-radius: 2px;
            cursor: pointer;
        }
        #volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px; /* –†–æ–∑–º—ñ—Ä –ø–æ–≤–∑—É–Ω–∫–∞ */
            height: 16px;
            background: #EC4899; /* –ö–æ–ª—ñ—Ä –ø–æ–≤–∑—É–Ω–∫–∞ (—Ä–æ–∂–µ–≤–∏–π) */
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(236, 72, 153, 0.7);
        }
        #volume-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #EC4899;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(236, 72, 153, 0.7);
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100">
    
    <!-- NEW: –§–æ–Ω–æ–≤–∞ –º—É–∑–∏–∫–∞. –ó–∞–º—ñ–Ω—ñ—Ç—å 'PATH_TO_YOUR_MUSIC.mp3' –Ω–∞ —Ä–µ–∞–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è -->
    <audio id="background-music" loop>
        <source src="music.mp3" type="audio/mpeg">
        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –∞—É–¥—ñ–æ.
    </audio>

    <!-- –ì–æ–ª–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Å—ñ—Ö –µ–∫—Ä–∞–Ω—ñ–≤ -->
    <!-- –ó–º—ñ–Ω–µ–Ω–æ h-screen –Ω–∞ min-h-screen –¥–ª—è –¥–æ–∑–≤–æ–ª—É –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ -->
    <div id="app-container" class="relative w-full min-h-screen">

        <!-- –†–µ–≥—É–ª—è—Ç–æ—Ä –≥—É—á–Ω–æ—Å—Ç—ñ -->
        <div id="volume-control-container">
            <span class="text-white text-lg">üîä</span> <!-- –Ü–∫–æ–Ω–∫–∞ –≥—É—á–Ω–æ—Å—Ç—ñ -->
            <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.5">
        </div>

        <!-- –ï–∫—Ä–∞–Ω 1: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è / –ü—Ä–æ–ª–æ–≥ -->
        <div id="loader-screen" class="w-full h-full flex flex-col items-center justify-center p-4 bg-black">
            <div class="w-full max-w-2xl font-game text-sm md:text-base text-green-400">
                <pre id="terminal-output" class="whitespace-pre-wrap"></pre>
            </div>
            <div id="agent-profile" class="hidden mt-8 text-center animate-pulse">
                <!-- –ó–ê–ú–Ü–ù–Ü–¢–¨ –¶–ï –ü–û–°–ò–õ–ê–ù–ù–Ø –ù–ê –§–û–¢–û –Æ–õ–Ü -->
                <img src="https://placehold.co/200x200/EC4899/FFFFFF?text=AGENT+JJ-27" alt="–§–æ—Ç–æ –∞–≥–µ–Ω—Ç–∞ –Æ–ª—ñ" class="rounded-full border-4 border-pink-500 mx-auto mb-4">
                <button id="start-mission-btn" class="font-game bg-pink-600 text-white py-2 px-4 rounded-lg hover:bg-pink-700 transition-all">–ü–û–ß–ê–¢–ò –ú–Ü–°–Ü–Æ</button>
            </div>
        </div>

        <!-- –ï–∫—Ä–∞–Ω 2: –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –∫–∞—Ä—Ç–∞ —Å–≤—ñ—Ç—ñ–≤ -->
        <div id="map-screen" class="hidden w-full h-full flex flex-col items-center justify-center p-4 bg-cover bg-center" style="background-image: url('https://placehold.co/1920x1080/1F2937/4B5563?text=–ö–∞—Ä—Ç–∞+–í—Å—Ä–∞—Ç–æ—Å–≤—ñ—Ç—É');">
            <div class="bg-black bg-opacity-70 p-8 rounded-xl shadow-2xl">
                <h1 class="font-game text-2xl md:text-4xl text-center text-pink-500 mb-8">–ö–∞—Ä—Ç–∞ –í—Å—Ä–∞—Ç–æ—Å–≤—ñ—Ç—É</h1>
                <div id="levels-grid" class="grid grid-cols-2 md:grid-cols-3 gap-6">
                    <!-- –Ü–∫–æ–Ω–∫–∏ —Ä—ñ–≤–Ω—ñ–≤ –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ —Å—é–¥–∏ —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>
        </div>
        
        <!-- –ï–∫—Ä–∞–Ω 3: –†—ñ–≤–µ–Ω—å-–∫–≤–µ—Å—Ç (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä) -->
        <div id="level-screen" class="hidden w-full h-full flex flex-col items-center justify-center p-4 bg-gray-900 bg-opacity-90">
            <div id="level-content" class="w-full max-w-3xl text-center bg-gray-800 p-8 rounded-xl shadow-2xl border-2 border-pink-500">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Ä—ñ–≤–Ω—è –±—É–¥–µ –¥–æ–¥–∞–Ω–∏–π —Å—é–¥–∏ —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
        
        <!-- –ï–∫—Ä–∞–Ω 4: –§—ñ–Ω–∞–ª—å–Ω–∞ –±–∏—Ç–≤–∞ -->
        <div id="final-battle-screen" class="hidden w-full h-full flex flex-col items-center justify-center p-4 bg-black text-center">
            <h1 class="font-game text-3xl text-red-500 mb-4 animate-pulse">–§–Ü–ù–ê–õ–¨–ù–ê –ë–ò–¢–í–ê!</h1>
            
            <!-- –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –±–æ—Å–∞ -->
            <!-- –ó–º—ñ–Ω–µ–Ω–æ —Ä–æ–∑–º—ñ—Ä –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Tailwind CSS -->
            <img src="BossFight.png" alt="–í—Å—Ä–∞—Ç–∏–π –ß–µ—Ä–≤'—è–∫" class="mb-4 rounded-lg mx-auto w-full max-w-xl lg:max-w-2xl">
            
            <!-- HP-–±–∞—Ä –±–æ—Å–∞ -->
            <div class="hp-bar-container">
                <div id="boss-hp-bar-fill" class="hp-bar-fill">100% HP</div>
            </div>

            <!-- –û–ø–∏—Å –±–∏—Ç–≤–∏ -->
            <p class="max-w-2xl mx-auto mb-4 text-lg">–ü–µ—Ä–µ–¥ —Ç–æ–±–æ—é –ø–æ—Å—Ç–∞—î –≤—Ç—ñ–ª–µ–Ω–Ω—è —Ç–≤–æ–≥–æ –Ω–∞–π–±—ñ–ª—å—à–æ–≥–æ —Å—Ç—Ä–∞—Ö—É: –≥—ñ–≥–∞–Ω—Ç—Å—å–∫–∏–π, —Å–ª–∏–∑—å–∫–∏–π, –ø—ñ–∫—Å–µ–ª—å–Ω–∏–π **–í—Å—Ä–∞—Ç–∏–π –ß–µ—Ä–≤'—è–∫**. –í—ñ–Ω –∑–≤–∏–≤–∞—î—Ç—å—Å—è, –∞ –π–æ–≥–æ —Ç—ñ–ª–æ –ø–µ—Ä–µ–ª–∏–≤–∞—î—Ç—å—Å—è –Ω–µ–ø—Ä–∏—î–º–Ω–∏–º–∏ –≤—ñ–¥—Ç—ñ–Ω–∫–∞–º–∏ –Ω—É–¥–Ω–æ-–±–µ–∂–µ–≤–æ–≥–æ. –í—ñ–Ω –ø–æ–≥—Ä–æ–∂—É—î –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –≤–µ—Å—å —Å–≤—ñ—Ç –Ω–∞ —Å—É—Ü—ñ–ª—å–Ω—É —Ü–∏—Ç–∞—Ç—É –∑ –ø–∞–±–ª—ñ–∫–∞ –¥–ª—è –º–∞—Ç—É—Å—å.</p>
            <p class="max-w-2xl mx-auto mb-4 text-lg">–ê–ª–µ —Ç–∏, –µ–ª–µ–≥–∞–Ω—Ç–Ω–∞ —ñ –±–µ–∑—Å—Ç—Ä–∞—à–Ω–∞ –∞–≥–µ–Ω—Ç–∫–∞ **JJ-27**, —Å—Ç–æ—ó—à –Ω–∞–≤–ø—Ä–æ—Ç–∏ –≤ —Å–ª—ñ–ø—É—á–æ–º—É –±–æ–π–æ–≤–æ–º—É –∫—É–ø–∞–ª—å–Ω–∏–∫—É, –æ–∑–±—Ä–æ—î–Ω–∞ –∫–µ–ª–∏—Ö–æ–º —ñ —Å–∞—Ä–∫–∞–∑–º–æ–º. –¢–∏ –∑–Ω–∞—î—à —Å–µ–∫—Ä–µ—Ç–Ω—É —Ñ—Ä–∞–∑—É-–µ–∫–∑–æ—Ä—Ü–∏–∑–º, —â–æ –∑–¥–∞—Ç–Ω–∞ –≤–∏–≥–Ω–∞—Ç–∏ –±—É–¥—å-—è–∫–æ–≥–æ —Ä–æ–∑–±—ñ–π–Ω–∏–∫–∞!</p>
            
            <form id="final-form" class="flex flex-col items-center gap-4">
                <button type="button" id="player-attack-btn" class="font-game bg-blue-600 text-white py-2 px-6 rounded-lg hover:bg-blue-700 transition-all shadow-lg">–ê–¢–ê–ö–£–í–ê–¢–ò –ß–ï–†–í'–Ø–ö–ê!</button>
                <input type="text" id="final-input" class="bg-gray-700 border-2 border-gray-600 rounded-lg p-2 text-white w-full max-w-sm text-center" placeholder="–í–≤–µ–¥–∏ –ø–µ—Ä–µ–º–æ–∂–Ω—É —Ñ—Ä–∞–∑—É..." disabled>
                <button type="submit" id="submit-phrase-btn" class="font-game bg-green-500 text-black py-2 px-6 rounded-lg hover:bg-green-400 transition-all shadow-lg" disabled>–í–ò–ì–ù–ê–¢–ò!</button>
            </form>
        </div>

        <!-- –ï–∫—Ä–∞–Ω 5: –ù–∞–≥–æ—Ä–æ–¥–∞ -->
        <div id="reward-screen" class="hidden w-full h-full flex flex-col items-center justify-center p-4 bg-cover bg-center" style="background-image: url('https://placehold.co/1920x1080/4C1D95/A78BFA?text=–ü–µ—Ä–µ–º–æ–≥–∞!');">
            <div class="bg-black bg-opacity-75 p-10 rounded-xl border-4 border-yellow-400 text-center">
                <h1 class="font-game text-2xl md:text-3xl text-yellow-400 mb-4">–ü–ï–†–ï–ú–û–ì–ê!</h1>
                <h2 class="text-xl md:text-2xl mb-6">–û—Ñ—ñ—Ü—ñ–π–Ω–∏–π –î–∏–ø–ª–æ–º</h2>
                <p class="text-2xl md:text-4xl font-bold text-pink-400 mb-2">–Æ–ª—ñ—ó</p>
                <p class="mb-6">–ü–æ—á–µ—Å–Ω—ñ–π –°–µ–∫—Å—ñ-–ú–∞–Ω–¥—Ä—ñ–≤–Ω–∏—Ü—ñ —Ç–∞ –í–∏–Ω–∏—â—É–≤–∞—á—Ü—ñ –í—Å—Ä–∞—Ç–∏—Ö –ß–µ—Ä–≤'—è–∫—ñ–≤</p>
                <p class="text-xs text-gray-400 mb-8">–ó–∞—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ –†–∞–¥–æ—é –Ñ–≤—Ä–æ—Ç—É—Ä—á–∏–∫–∞, –ì—Ä–∞—Ñ–æ—Å–ª–∞–≤–æ–º —Ç–∞ –±–æ–∫–∞–ª–æ–º –≤–∏–Ω–∞.</p>
                <button id="gallery-btn" class="font-game bg-pink-600 text-white py-3 px-6 rounded-lg hover:bg-pink-700 transition-all">
                    –í—ñ–¥–∫—Ä–∏—Ç–∏ —Ç—É—Å–æ–≤–æ—á–Ω–∏–π –í—Å–µ—Å–≤—ñ—Ç
                </button>
            </div>
        </div>
        
        <!-- –ï–∫—Ä–∞–Ω 6: –ì–∞–ª–µ—Ä–µ—è -->
        <div id="gallery-screen" class="hidden w-full h-full overflow-y-auto p-8 bg-gray-900">
            <!-- UPDATED: –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≥–∞–ª–µ—Ä–µ—ó -->
            <h1 class="font-game text-4xl text-center text-pink-500 mb-8">–¢—É—Å–æ–≤–æ—á–Ω–∏–π –í—Å–µ—Å–≤—ñ—Ç –Æ–ª—ñ</h1>
            <div class="max-w-6xl mx-auto">
                <!-- UPDATED: –°–µ–∫—Ü—ñ—è 1 -->
                <h2 class="font-game text-2xl text-green-400 mb-4">–í–∏–∫–æ–Ω–∞–Ω—ñ –º—ñ—Å—ñ—ó –ø–æ –∞–Ω—ñ–≥—ñ–ª—è—Ü—ñ—ó –∞–ª–∫–æ–≥–æ–ª—å–Ω–∏—Ö –Ω–∞–ø–æ—ó–≤</h2>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-8">
                    <!-- –ó–ê–ú–Ü–ù–Ü–¢–¨ –¶–Ü –ó–û–ë–†–ê–ñ–ï–ù–ù–Ø –ù–ê –†–ï–ê–õ–¨–ù–Ü –§–û–¢–û –ú–Ü–°–Ü–ô -->
                    <img src="11.jpg" class="rounded-lg shadow-lg w-full h-auto object-cover">
                    <img src="22.jpg" class="rounded-lg shadow-lg w-full h-auto object-cover">
                    <img src="33.jpg" class="rounded-lg shadow-lg w-full h-auto object-cover">
                    <img src="44.jpg" class="rounded-lg shadow-lg w-full h-auto object-cover">
                </div>
                <!-- UPDATED: –°–µ–∫—Ü—ñ—è 2 -->
                <h2 class="font-game text-2xl text-green-400 mb-4">–ß–ª–µ–Ω–∏ –∫–æ–º–∞–Ω–¥–∏ –∞–≥–µ–Ω—Ç–∞</h2>
                   <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                    <!-- –ó–ê–ú–Ü–ù–Ü–¢–¨ –¶–Ü –ë–õ–û–ö–ò –ù–ê –í–ê–®–Ü –í–Ü–î–ï–û -->
                    <div class="bg-gray-800 p-2 rounded-lg">
                        <video controls class="w-full rounded-md">
                            <source src="111.mp4" type="video/mp4">
                            –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –≤—ñ–¥–µ–æ.
                        </video>
                        <p class="text-center mt-2">–ú—ñ–∂–Ω–∞—Ä–æ–¥–Ω–∞ —Å–ø—ñ–≤–ø—Ä–∞—Ü—è –∑ –∞–≥–µ–Ω—Ç–∞–º–∏ –Ü–Ω—Ç–µ—Ä–ø–æ–ª—É</p>
                    </div>
                       <div class="bg-gray-800 p-2 rounded-lg">
                        <video controls class="w-full rounded-md">
                            <source src="222.mp4" type="video/mp4">
                            –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –≤—ñ–¥–µ–æ.
                        </video>
                        <p class="text-center mt-2">–í—Ç–∏—Ä–∞–Ω–Ω—è –≤ –¥–æ–≤—ñ—Ä—É –ø—ñ–¥ –ø—Ä–∏–∫—Ä–∏—Ç—Ç—è–º</p>
                    </div>
                   </div>
                   <!-- –°–µ–∫—Ü—ñ—è 3: –ù–∞–≥–æ—Ä–æ–¥–∏ -->
                   <h2 class="font-game text-2xl text-green-400 mb-4">–§–µ–π–∫–æ–≤—ñ –Ω–∞–≥–æ—Ä–æ–¥–∏</h2>
                   <div class="space-y-4 text-lg">
                    <p class="bg-gray-800 p-3 rounded-lg">üèÖ –û—Ä–¥–µ–Ω "–ü–ª–∞—Å—Ç–∏–∫–æ–≤–æ–≥–æ –°—Ç—ñ–ª—å—Ü—è –Ü —Å—Ç—É–ø–µ–Ω—è"</p>
                    <p class="bg-gray-800 p-3 rounded-lg">üèÖ –ú–µ–¥–∞–ª—å "–ó–∞ –≤–∑—è—Ç—Ç—è –ø–∞—Ä–∫–∞–Ω—É"</p>
                    <p class="bg-gray-800 p-3 rounded-lg">üèÜ –ü—Ä–µ–º—ñ—è "–ú—ñ—Å –ö—Ä—î–≤–µ—Ç–∫–∞ 2025"</p>
                   </div>
               </div>
               <button id="back-to-reward-btn" class="font-game fixed top-4 right-4 bg-gray-700 text-white py-2 px-4 rounded-lg hover:bg-gray-600 transition-all">–ù–∞–∑–∞–¥</button>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ -->
        <div id="modal-container" class="hidden">
            <div id="modal-backdrop"></div>
            <div id="modal" class="w-11/12 max-w-md bg-gray-800 rounded-xl p-6 text-center border-4">
                <div id="modal-content"></div>
                <button id="modal-close-btn" class="mt-6 font-game bg-pink-600 text-white py-2 px-6 rounded-lg hover:bg-pink-700 transition-all">–î–ê–õ–Ü</button>
            </div>
        </div>

        <!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è –∞—Ç–∞–∫ –±–æ—Å–∞ -->
        <div id="boss-attack-overlay"></div>

    </div>

    <script>
        // --- –ì–õ–û–ë–ê–õ–¨–ù–Ü –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –¢–ê –ó–ú–Ü–ù–ù–Ü ---
        
        const terminalOutput = document.getElementById('terminal-output');
        const agentProfile = document.getElementById('agent-profile');
        const startMissionBtn = document.getElementById('start-mission-btn');
        const levelsGrid = document.getElementById('levels-grid');
        const finalForm = document.getElementById('final-form');
        const finalInput = document.getElementById('final-input');
        const submitPhraseBtn = document.getElementById('submit-phrase-btn'); // –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–µ—Ä–µ–º–æ–∂–Ω–æ—ó —Ñ—Ä–∞–∑–∏
        const playerAttackBtn = document.getElementById('player-attack-btn'); // –ö–Ω–æ–ø–∫–∞ –∞—Ç–∞–∫–∏ –≥—Ä–∞–≤—Ü—è
        const bossHpBarFill = document.getElementById('boss-hp-bar-fill'); // –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è HP-–±–∞—Ä—É
        const galleryBtn = document.getElementById('gallery-btn');
        const backToRewardBtn = document.getElementById('back-to-reward-btn');
        const bossAttackOverlay = document.getElementById('boss-attack-overlay'); // –û–≤–µ—Ä–ª–µ–π –¥–ª—è –∞—Ç–∞–∫–∏ –±–æ—Å–∞
        const backgroundMusic = document.getElementById('background-music'); // –§–æ–Ω–æ–≤–∞ –º—É–∑–∏–∫–∞
        const volumeSlider = document.getElementById('volume-slider'); // –†–µ–≥—É–ª—è—Ç–æ—Ä –≥—É—á–Ω–æ—Å—Ç—ñ

        // –ú–æ–¥–∞–ª—å–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏
        const modalContainer = document.getElementById('modal-container');
        const modalContent = document.getElementById('modal-content');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const modal = document.getElementById('modal');

        // –ó–≤—É–∫–æ–≤—ñ –µ—Ñ–µ–∫—Ç–∏
        const synth = new Tone.Synth().toDestination();
        const clickSound = () => synth.triggerAttackRelease("C4", "8n");
        const successSound = () => {
            const synth = new Tone.Synth().toDestination();
            synth.triggerAttackRelease("C5", "8n", Tone.now());
            synth.triggerAttackRelease("E5", "8n", Tone.now() + 0.1);
            synth.triggerAttackRelease("G5", "8n", Tone.now() + 0.2);
        };
        const failureSound = () => {
            const synth = new Tone.FMSynth().toDestination();
            synth.triggerAttackRelease("A2", "4n");
        };
        const winSound = () => {
             const polySynth = new Tone.PolySynth(Tone.Synth).toDestination();
             polySynth.triggerAttackRelease(["C4", "E4", "G4", "C5"], 1);
        }

        // –Ü–≥—Ä–æ–≤–∏–π —Å—Ç–∞–Ω
        let gameState = {
            currentLevel: 0,
            completedLevels: [],
        };

        // –Ü–≥—Ä–æ–≤–∏–π —Å—Ç–∞–Ω –±–∏—Ç–≤–∏
        let bossHP = 100; // –ü–æ—Ç–æ—á–Ω–µ –∑–¥–æ—Ä–æ–≤'—è –±–æ—Å–∞
        const bossMaxHP = 100; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–µ –∑–¥–æ—Ä–æ–≤'—è –±–æ—Å–∞
        const playerAttackDamage = 25; // –°–∫—ñ–ª—å–∫–∏ HP –∑–Ω—ñ–º–∞—î –æ–¥–Ω–∞ –∞—Ç–∞–∫–∞ –≥—Ä–∞–≤—Ü—è
        const winningPhraseThreshold = 25; // –í—ñ–¥—Å–æ—Ç–æ–∫ HP, –ø—Ä–∏ —è–∫–æ–º—É –º–æ–∂–Ω–∞ –≤–≤–µ—Å—Ç–∏ —Ñ—Ä–∞–∑—É

        // –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–ª—è –∞—Ç–∞–∫–∏ –±–æ—Å–∞ (—à–ª—è—Ö–∏ –¥–æ —Ñ–∞–π–ª—ñ–≤ —É —Ç—ñ–π —Å–∞–º—ñ–π –ø–∞–ø—Ü—ñ)
        const bossAttackImages = [
            'BossAttack1.jpg',
            'BossAttack2.jpg',
            'BossAttack3.jpg'
        ];
        let currentBossAttackImageIndex = 0; // –î–ª—è —Ü–∏–∫–ª—ñ—á–Ω–æ–≥–æ –ø–æ–∫–∞–∑—É –∑–æ–±—Ä–∞–∂–µ–Ω—å –∞—Ç–∞–∫

        // –î–∞–Ω—ñ –ø—Ä–æ —Ä—ñ–≤–Ω—ñ –∫–≤–µ—Å—Ç—É
        const levels = [
            {
                name: "–Ü—Ç–∞–ª—ñ—è: –í—É–ª–∏—Ü—è —ñ–º. –ë–∞–ª–µ—Ä—ñ–Ω–∏-–ö–∞–ø—É—á—á—ñ–Ω–∏",
                icon: "üëå",
                situation: "–¢–∏ –π–¥–µ—à –ø–æ —Ä–æ–∑–ø–µ—á–µ–Ω—ñ–π –≤—É–ª–∏—Ü—ñ, –ø–æ–≤—ñ—Ç—Ä—è –ø–∞—Ö–Ω–µ –ø—ñ—Ü–æ—é —ñ –∞–Ω–∞—Ä—Ö—ñ—î—é. –†–∞–ø—Ç–æ–º –∑-–∑–∞ —Ä–æ–≥—É –≤–∏–±—ñ–≥–∞—î –º–∞–ª–∏–π –∫–∞—Ä–∞–ø—É–∑, —Å–∫–ª–∞–¥–∞—î –ø–∞–ª—å—Ü—ñ –≤ –±–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∏–π –∂–µ—Å—Ç üëå —ñ –≤–∏–≥—É–∫—É—î —Å–µ–∫—Ä–µ—Ç–Ω–µ –∫–æ–¥–æ–≤–µ —Å–ª–æ–≤–æ. –ó–≥–∞–¥–∞–π –π–æ–≥–æ, —â–æ–± –¥–µ–∑–∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ —Ç–µ–º–ø–æ—Ä–∞–ª—å–Ω—É –∞–Ω–æ–º–∞–ª—ñ—é!",
                taskType: "input",
                answer: ["–ø–ª–∞—Å—Ç–µ–ª—ñ–Ω–∞", "–ø–ª–∞—Å—Ç–µ–ª—ñ–Ω–æ", "–ø–ª–∞—Å—Ç–µ–ª—ñ–Ω—ñ"],
                correctFeedback: "ACCESS GRANTED! –¢–∏ –Ω–∞ –∫—Ä–æ–∫ –±–ª–∏–∂—á–µ –¥–æ –ø–µ—Ä–µ–º–æ–≥–∏ —ñ —Ö–∞–º–æ–Ω—É.",
                wrongFeedback: "ERROR! –°–ø—Ä–æ–±—É–π —â–µ, —ñ–Ω–∞–∫—à–µ –í—Å–µ—Å–≤—ñ—Ç –ú–µ–º—ñ–≤ –Ω–∞–∑–∞–≤–∂–¥–∏ —Å—Ç–∞–Ω–µ –Ω—É–¥–Ω–∏–º."
            },
            {
                name: "–î–æ—Ä–æ–≥–∏–π –±—ñ—á-–∫–ª–∞–± –ü–µ—Å–∫–∞—Ä–∏",
                icon: "üèñÔ∏è",
                situation: "–°–æ–Ω—Ü–µ, –º–æ—Ä–µ, —ñ —Ç–∏ –≤ —Å–≤–æ—î–º—É 100500-–º—É –∫—É–ø–∞–ª—å–Ω–∏–∫—É. –ü–æ–≤–∑ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –∑–∞—Å–º–∞–≥–ª–∏–π –º–∞—á–æ-–∞–≥–µ–Ω—Ç. –í—ñ–Ω –∫–∏–¥–∞—î —Ç–æ–±—ñ –ø–∞—Ä–æ–ª—å, —â–æ–± –∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ —Ç–≤—ñ–π —Å–ø–ª—è—á–∏–π —Ä–µ–∂–∏–º —Å–ø–µ—Ü–∞–≥–µ–Ω—Ç–∞. –©–æ —Ü–µ –∑–∞ —Å–ª–æ–≤–æ?",
                taskType: "input",
                answer: ["–±—ñ—á", "bitch", "beach"],
                correctFeedback: "–ü–∞—Ä–æ–ª—å –ø—Ä–∏–π–Ω—è—Ç–æ! –¢–≤–æ—ó –±–æ–π–æ–≤—ñ –Ω–∞–≤–∏—á–∫–∏ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω—ñ!",
                wrongFeedback: "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø–∞—Ä–æ–ª—å. –ó–≤'—è–∑–æ–∫ –≤—Ç—Ä–∞—á–µ–Ω–æ. –ù–∞ —Ç–µ–±–µ –≤–∂–µ –ø–æ–ª—é—é—Ç—å —á–∞–π–∫–∏-—à–ø–∏–≥—É–Ω–∏."
            },
            {
                name: "–ü–∞—Ä–∏–∂: –ó–π–æ–º–Ω–∞ —Ö–∞—Ç–∞",
                icon: "üòà",
                situation: "–í–∏ –∑ SerGay –≤ —Ä–æ–º–∞–Ω—Ç–∏—á–Ω–æ–º—É –ü–∞—Ä–∏–∂—ñ. –í–Ω–æ—á—ñ –Ω–∞–¥ –≤–∞—à–∏–º –ª—ñ–∂–∫–æ–º —â–æ—Å—å –Ω–∞–≤–∏—Å–∞—î. –¶–µ –Ω–µ –ï–π—Ñ–µ–ª–µ–≤–∞ –≤–µ–∂–∞. –©–æ –±—É–ª–æ –∑–æ–±—Ä–∞–∂–µ–Ω–æ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω—ñ?",
                taskType: "input",
                answer: ["–¥–µ–º–æ–Ω–∏", "–¥–µ–º–æ–Ω"],
                correctFeedback: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ù–∞–≤—ñ—Ç—å –¥–µ–º–æ–Ω–∏ –Ω–µ –º–æ–∂—É—Ç—å –∑—ñ–ø—Å—É–≤–∞—Ç–∏ –≤–∞–º —Ä–æ–º–∞–Ω—Ç–∏–∫—É.",
                wrongFeedback: "–ù—ñ, —Ü–µ –±—É–ª–∏ –Ω–µ –∫—Ä—É–∞—Å–∞–Ω–∏. –°–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑!"
            },
            {
                name: "–†–∏–º: –ü–∞—Ä–∫–∞–Ω–Ω–∏–π —Å–≤—ñ—Ç",
                icon: "üöß",
                situation: "–ê–≥–µ–Ω—Ç–∫–∞ –Ø–Ω–∞ –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –ø–æ–¥–æ–ª–∞—Ç–∏ –ø–µ—Ä–µ—à–∫–æ–¥—É, –∞–ª–µ —ó–π –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Ç–≤–æ—è –¥–æ–ø–æ–º–æ–≥–∞. –í–æ–Ω–∞ –±–ª–∞–≥–∞–ª—å–Ω–æ –¥–∏–≤–∏—Ç—å—Å—è –Ω–∞ —Ç–µ–±–µ —ñ –∫–∞–∂–µ: '–ü—ñ–¥—Å—Ç—Ä–∞—Ö—É–π!'. –¢–≤–æ—ó –¥—ñ—ó?",
                taskType: "choices",
                choices: [
                    { id: "a", text: "–≤—Ç–µ–∫–ª–∞ –≤ —Ç–∞–∫—Å—ñ" },
                    { id: "b", text: "–≤—ñ–¥—Å—å–æ—Ä–±–Ω—É–ª–∞ –∑ –±–æ–∫–∞–ª—É –≤–∏–Ω–∞" },
                    { id: "c", text: "—Å–∫–∞–∑–∞–ª–∞ ‚Äú–•—Ç–æ? —è?‚Äù" },
                    { id: "d", text: "–ø—ñ–¥—Å—Ç—Ä–∞—Ö—É–≤–∞–ª–∞" }
                ],
                answer: "d",
                correctFeedback: "–¢–ê–ö! –ö–æ–º–∞–Ω–¥–Ω–∞ —Ä–æ–±–æ—Ç–∞ ‚Äî –∫–ª—é—á –¥–æ —É—Å–ø—ñ—Ö—É!",
                wrongFeedback: "–ó—Ä–∞–¥–∞! –ú—ñ—Å—ñ—è –ø—ñ–¥ –∑–∞–≥—Ä–æ–∑–æ—é! –†—ñ–≤–µ–Ω—å –¥–æ–≤—ñ—Ä–∏ –Ø–Ω–∏ –≤–ø–∞–≤ –¥–æ 5%."
            },
            {
                name: "–û–ø–µ—Ä–∞—Ü—ñ—è '–ü–ª–∞—Å—Ç–∏–∫–æ–≤–∏–π –¢—Ä–æ–Ω'",
                icon: "ü™ë",
                situation: "–û—Å—Ç–∞–Ω–Ω—ñ —Ö–≤–∏–ª–∏–Ω–∏ –ø–µ—Ä–µ–¥ –µ–≤–∞–∫—É–∞—Ü—ñ—î—é –¥–æ –∞–µ—Ä–æ–ø–æ—Ä—Ç—É –§—å—é–º—ñ—á—ñ–Ω–æ. –¢–∏ –ø–æ–º—ñ—á–∞—î—à –±–µ–∑—Ü—ñ–Ω–Ω–∏–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç. –¢–≤–æ—è –≤–Ω—É—Ç—Ä—ñ—à–Ω—è –∫–ª–µ–ø—Ç–æ–º–∞–Ω–∫–∞-–∫–æ–ª–µ–∫—Ü—ñ–æ–Ω–µ—Ä–∫–∞ –ª–µ–¥—å –Ω–µ –±–µ—Ä–µ –≥–æ—Ä—É. –©–æ —Ü–µ –±—É–ª–æ?",
                taskType: "input",
                answer: ["–ø–ª–∞—Å—Ç–∏–∫–æ–≤–∏–π —Å—Ç—ñ–ª–µ—Ü—å", "—Å—Ç—ñ–ª–µ—Ü—å", "–∫—Ä—ñ—Å–ª–æ", "—Å—Ç—É–ª—å—á–∏–∫"],
                correctFeedback: "–¢–∏ –≤—Ç—Ä–∏–º–∞–ª–∞—Å—å! –°–ø—Ä–∞–≤–∂–Ω—ñ–π –∞–≥–µ–Ω—Ç –≤–º—ñ—î –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ —Å–≤–æ—ó —ñ–º–ø—É–ª—å—Å–∏!",
                wrongFeedback: "–ù—ñ, –Ω–µ –ø–∞—Å–ø–æ—Ä—Ç–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å. –î—É–º–∞–π –∫—Ä–∞—â–µ!"
            },
            {
                name: "–í–∞—Ç–∏–∫–∞–Ω: –ê—É–¥—ñ—î–Ω—Ü—ñ—è —É –ü–∞–ø–∏",
                icon: "üáªüá¶",
                situation: "–¢–µ–±–µ –Ω–µ—Å–ø–æ–¥—ñ–≤–∞–Ω–æ –∑–∞–ø—Ä–æ—Å–∏–ª–∏ –Ω–∞ —Å–µ–∫—Ä–µ—Ç–Ω—É –∞—É–¥—ñ—î–Ω—Ü—ñ—é –¥–æ —Å–∞–º–æ–≥–æ –ü–∞–ø–∏ –†–∏–º—Å—å–∫–æ–≥–æ! –í—ñ–Ω –≤–∏—è–≤–∏–≤—Å—è –∫–ª–∞—Å–Ω–∏–º –º—É–∂–∏–∫–æ–º —ñ –∑–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞–≤ —Ç–æ–±—ñ —Ö–∏–ª—å–Ω—É—Ç–∏ –ø–æ –∫–µ–ª–∏—Ö—É. –©–æ –≤–∏ –ø–∏–ª–∏ –∑ –ü–∞–ø–∫–æ—é —É –í–∞—Ç–∏–∫–∞–Ω—ñ?",
                taskType: "choices",
                choices: [
                    { id: "a", text: "–≤—ñ—Å–∫—ñ-—Å–∞—É–µ—Ä" },
                    { id: "b", text: "–ø—ñ–Ω—É-–∫–æ–ª–∞–¥—É" },
                    { id: "c", text: "–∫–æ–∫–æ—Å–æ–≤—É –≤–æ–¥—É" },
                    { id: "d", text: "—Å–ª—å–æ–∑–∏ —Ö–ª–æ–ø—á–∏–∫—ñ–≤" }
                ],
                answer: "c",
                correctFeedback: "–°–∞–º–µ —Ç–∞–∫! –°–≤—è—Ç–∞ –∫–æ–∫–æ—Å–æ–≤–∞ –≤–æ–¥–∞ –¥–ª—è –æ—á–∏—â–µ–Ω–Ω—è –¥—É—à—ñ —Ç–∞ –≥–∞—Ä–Ω–æ–≥–æ –Ω–∞—Å—Ç—Ä–æ—é!",
                wrongFeedback: "–ë–ª–∏–∑—å–∫–æ, –∞–ª–µ –Ω—ñ. –ü–∞–ø–∞ –Ω–µ —Å—Ö–≤–∞–ª—é—î —Ç–∞–∫–∏–π –≤–∏–±—ñ—Ä, –¥–æ–Ω—é –º–æ—è."
            }
        ];

        // --- –§–£–ù–ö–¶–Ü–á ---

        /**
         * –ü–µ—Ä–µ–º–∏–∫–∞—î –≤–∏–¥–∏–º—ñ—Å—Ç—å –µ–∫—Ä–∞–Ω—ñ–≤.
         * @param {string} screenId ID –µ–∫—Ä–∞–Ω—É, —è–∫–∏–π –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–æ–∫–∞–∑–∞—Ç–∏.
         */
        function showScreen(screenId) {
            const screens = document.querySelectorAll('#app-container > div');
            screens.forEach(screen => {
                if (screen.id === screenId) {
                    screen.classList.remove('hidden');
                } else {
                    screen.classList.add('hidden');
                }
            });

            // –õ–æ–≥—ñ–∫–∞ –∑–º—ñ–Ω–∏ –º—É–∑–∏–∫–∏ –ø—Ä–∏ –∑–º—ñ–Ω—ñ –µ–∫—Ä–∞–Ω—É
            if (screenId === 'final-battle-screen') {
                backgroundMusic.src = 'BossFight.mp3';
                backgroundMusic.play().catch(e => console.error("Autoplay was prevented:", e));
            } else if (screenId === 'reward-screen' || screenId === 'gallery-screen') {
                // –ü—ñ—Å–ª—è –ø–µ—Ä–µ–º–æ–≥–∏ –º—É–∑–∏–∫–∞ –ø–æ–≤–Ω—ñ—Å—Ç—é –≤–∏–º–∏–∫–∞—î—Ç—å—Å—è
                backgroundMusic.pause();
                backgroundMusic.currentTime = 0; // –°–∫–∏–¥–∞—î–º–æ –ø–æ–∑–∏—Ü—ñ—é –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è
            }
            // –ú—É–∑–∏–∫–∞ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —Ç—ñ—î—é –∂ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥—ñ –Ω–∞ map-screen —Ç–∞ level-screen
        }
        
        function typeEffect(element, text, callback) {
            let i = 0;
            element.innerHTML = "";
            const cursor = '<span class="blinking-cursor"></span>';
            const interval = setInterval(() => {
                if (i < text.length) {
                    element.innerHTML = text.substring(0, i + 1) + cursor;
                    i++;
                } else {
                    clearInterval(interval);
                    element.innerHTML = text;
                    if (callback) callback();
                }
            }, 50);
        }

        function startPrologue() {
            const prologueText = `> INITIATING PROTOCOL JJ-27...\n> SCANNING RETINA... ACCESS GRANTED.\n> ANALYZING AGENT'S ELEGANCE LEVEL... 98.7% (STUNNING).\n> DETECTING TRUE STORIES DATABASE... FULLY LOADED.\n> CHECKING SHRIMP RESERVES... DANGEROUSLY LOW.\n> UPLOADING AGENT PROFILE...`;
            typeEffect(terminalOutput, prologueText, () => {
                agentProfile.classList.remove('hidden');
            });
            // –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –º—É–∑–∏–∫–∞ –¥–ª—è –ø—Ä–æ–ª–æ–≥—É –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
            backgroundMusic.src = 'music.mp3';
        }
        
        function updateMap() {
            levelsGrid.innerHTML = '';
            levels.forEach((level, index) => {
                const isCompleted = gameState.completedLevels.includes(index);
                const isUnlocked = index === 0 || gameState.completedLevels.includes(index - 1);

                const levelButton = document.createElement('button');
                levelButton.dataset.levelIndex = index;
                levelButton.disabled = !isUnlocked;
                
                let buttonClasses = 'font-game p-6 rounded-lg border-2 flex flex-col items-center justify-center transition-all ';
                if (isCompleted) {
                    buttonClasses += 'bg-green-500 border-green-400 text-black cursor-default';
                } else if (isUnlocked) {
                    buttonClasses += 'bg-pink-600 border-pink-500 text-white hover:bg-pink-500 animate-pulse';
                } else {
                    buttonClasses += 'bg-gray-700 border-gray-600 text-gray-500 cursor-not-allowed';
                }
                levelButton.className = buttonClasses;
                
                levelButton.innerHTML = `
                    <span class="text-3xl mb-2">${isUnlocked ? level.icon : '‚ùì'}</span>
                    <span class="text-xs text-center">${level.name}</span>
                `;

                if (isUnlocked && !isCompleted) {
                    levelButton.addEventListener('click', () => {
                           clickSound();
                           loadLevel(index);
                    });
                }
                
                levelsGrid.appendChild(levelButton);
            });

            if (gameState.completedLevels.length === levels.length) {
                addFinalBattleButton();
            }
        }
        
        function addFinalBattleButton() {
            const finalButton = document.createElement('button');
            finalButton.className = 'font-game p-6 rounded-lg border-2 flex flex-col items-center justify-center transition-all bg-red-600 border-red-500 text-white hover:bg-red-500 animate-pulse col-span-2 md:col-span-3';
            finalButton.innerHTML = `
                <span class="text-3xl mb-2">üí•</span>
                <span class="text-xs text-center">–§–Ü–ù–ê–õ–¨–ù–ò–ô –ë–û–°</span>
            `;
            finalButton.addEventListener('click', () => {
                clickSound();
                showScreen('final-battle-screen'); // showScreen –≤–∂–µ –æ–±—Ä–æ–±–∏—Ç—å –∑–º—ñ–Ω—É –º—É–∑–∏–∫–∏
            });
            levelsGrid.appendChild(finalButton);
        }

        function loadLevel(levelIndex) {
            gameState.currentLevel = levelIndex;
            const level = levels[levelIndex];
            const levelContent = document.getElementById('level-content');
            
            let taskHtml = '';
            if (level.taskType === 'input') {
                taskHtml = `
                    <form id="level-form">
                        <input type="text" id="level-input" class="bg-gray-700 border-2 border-gray-600 rounded-lg p-2 text-white w-full max-w-sm text-center" placeholder="–í–≤–µ–¥–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å...">
                        <button type="submit" class="mt-4 font-game bg-green-500 text-black py-2 px-6 rounded-lg hover:bg-green-400 transition-all">–í–Ü–î–ü–û–í–Ü–°–¢–ò</button>
                    </form>
                `;
            } else if (level.taskType === 'choices') {
                const choicesHtml = level.choices.map(choice => 
                    `<button class="choice-btn w-full bg-pink-600 text-white p-3 rounded-lg hover:bg-pink-500" data-choice-id="${choice.id}">${choice.text}</button>`
                ).join('');
                taskHtml = `<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">${choicesHtml}</div>`;
            }

            levelContent.innerHTML = `
                <h2 class="font-game text-xl md:text-2xl text-pink-500 mb-4">${level.name}</h2>
                <p class="mb-6 text-gray-300">${level.situation}</p>
                ${taskHtml}
            `;
            
            showScreen('level-screen');

            if (level.taskType === 'input') {
                document.getElementById('level-form').addEventListener('submit', handleAnswerSubmit);
            } else if (level.taskType === 'choices') {
                document.querySelectorAll('.choice-btn').forEach(btn => {
                    btn.addEventListener('click', handleChoiceClick);
                });
            }
        }
        
        function handleAnswerSubmit(event) {
            event.preventDefault();
            const userInput = document.getElementById('level-input').value.trim().toLowerCase();
            checkAnswer(userInput);
        }
        
        function handleChoiceClick(event) {
            const userChoice = event.target.dataset.choiceId;
            checkAnswer(userChoice);
        }

        function checkAnswer(userAnswer) {
            const level = levels[gameState.currentLevel];
            let isCorrect = false;

            if (Array.isArray(level.answer)) {
                isCorrect = level.answer.includes(userAnswer);
            } else {
                isCorrect = userAnswer === level.answer;
            }

            if (isCorrect) {
                successSound();
                showModal(true, level.correctFeedback);
                if (!gameState.completedLevels.includes(gameState.currentLevel)) {
                    gameState.completedLevels.push(gameState.currentLevel);
                }
            } else {
                failureSound();
                showModal(false, level.wrongFeedback);
            }
        }
        
        function showModal(isCorrect, feedbackText) {
            modalContent.innerHTML = `<p class="text-lg">${feedbackText}</p>`;
            modal.className = `w-11/12 max-w-md bg-gray-800 rounded-xl p-6 text-center border-4 ${isCorrect ? 'border-green-500' : 'border-red-500'}`;
            modalContainer.classList.remove('hidden');
        }

        /**
         * –û–Ω–æ–≤–ª—é—î –≤—ñ–∑—É–∞–ª—å–Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è HP-–±–∞—Ä—É –±–æ—Å–∞.
         */
        function updateBossHPDisplay() {
            const hpPercentage = (bossHP / bossMaxHP) * 100;
            bossHpBarFill.style.width = `${hpPercentage}%`;
            bossHpBarFill.textContent = `${Math.max(0, bossHP)}% HP`; // –ó–∞–±–µ–∑–ø–µ—á—É—î–º–æ, —â–æ HP –Ω–µ –π–¥–µ –≤ –º—ñ–Ω—É—Å

            // –ó–º—ñ–Ω—é—î–º–æ –∫–æ–ª—ñ—Ä HP-–±–∞—Ä—É –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –≤—ñ–¥—Å–æ—Ç–∫–∞ HP
            if (hpPercentage > 50) {
                bossHpBarFill.style.backgroundColor = '#22c55e'; // –ó–µ–ª–µ–Ω–∏–π
            } else if (hpPercentage > 25) {
                bossHpBarFill.style.backgroundColor = '#facc15'; // –ñ–æ–≤—Ç–∏–π
                bossHpBarFill.style.color = '#111827'; // Dark text for readability
            } else {
                bossHpBarFill.style.backgroundColor = '#dc2626'; // –ß–µ—Ä–≤–æ–Ω–∏–π
                bossHpBarFill.style.color = '#F3F4F6'; // Light text for readability
            }

            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –Ω–∞—Å—Ç–∞–≤ —á–∞—Å –¥–ª—è –ø–µ—Ä–µ–º–æ–∂–Ω–æ—ó —Ñ—Ä–∞–∑–∏
            if (bossHP <= winningPhraseThreshold) {
                finalInput.disabled = false;
                submitPhraseBtn.disabled = false;
                playerAttackBtn.disabled = true; // –í–∏–º–∏–∫–∞—î–º–æ –∫–Ω–æ–ø–∫—É –∞—Ç–∞–∫–∏
                finalInput.placeholder = "–í–≤–µ–¥–∏ –ø–µ—Ä–µ–º–æ–∂–Ω—É —Ñ—Ä–∞–∑—É!";
                playerAttackBtn.classList.add('opacity-50', 'cursor-not-allowed'); // –ó–º–µ–Ω—à—É—î–º–æ –ø—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ –∞—Ç–∞–∫–∏
                submitPhraseBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                finalInput.classList.add('highlight-blink'); // –î–æ–¥–∞—î–º–æ –∫–ª–∞—Å –¥–ª—è –ø—ñ–¥—Å–≤—ñ—á—É–≤–∞–Ω–Ω—è/–º–∏–≥–æ—Ç—ñ–Ω–Ω—è
            } else {
                finalInput.disabled = true;
                submitPhraseBtn.disabled = true;
                finalInput.placeholder = "–ó–º–µ–Ω—à HP –±–æ—Å–∞, —â–æ–± –≤–≤–µ—Å—Ç–∏ —Ñ—Ä–∞–∑—É...";
                submitPhraseBtn.classList.add('opacity-50', 'cursor-not-allowed');
                finalInput.classList.remove('highlight-blink'); // –í–∏–¥–∞–ª—è—î–º–æ –∫–ª–∞—Å, —è–∫—â–æ —É–º–æ–≤–∞ –Ω–µ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è
            }
        }

        /**
         * –û–±—Ä–æ–±–ª—è—î –∞—Ç–∞–∫—É –≥—Ä–∞–≤—Ü—è.
         */
        function playerAttack() {
            clickSound();
            
            // –Ø–∫—â–æ HP –≤–∂–µ –Ω–∏–∑—å–∫–µ —ñ —Ñ—Ä–∞–∑—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–≤–æ–¥–∏—Ç–∏, –Ω–µ –¥–æ–∑–≤–æ–ª—è—î–º–æ –∞—Ç–∞–∫—É–≤–∞—Ç–∏
            if (bossHP <= winningPhraseThreshold && bossHP > 0) {
                alert("HP –±–æ—Å–∞ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –Ω–∏–∑—å–∫–µ! –í–≤–µ–¥—ñ—Ç—å –ø–µ—Ä–µ–º–æ–∂–Ω—É —Ñ—Ä–∞–∑—É!");
                return;
            } else if (bossHP <= 0) {
                 // –Ø–∫—â–æ –±–æ—Å –≤–∂–µ –º–µ—Ä—Ç–≤–∏–π, –Ω–µ –¥–æ–∑–≤–æ–ª—è—î–º–æ –∞—Ç–∞–∫—É–≤–∞—Ç–∏
                return;
            }

            playerAttackBtn.disabled = true; // –í–∏–º–∏–∫–∞—î–º–æ –∫–Ω–æ–ø–∫—É –∞—Ç–∞–∫–∏ –ø—ñ–¥ —á–∞—Å —Ö–æ–¥—É
            submitPhraseBtn.disabled = true; // –í–∏–º–∏–∫–∞—î–º–æ –∫–Ω–æ–ø–∫—É —Ñ—Ä–∞–∑–∏ –ø—ñ–¥ —á–∞—Å —Ö–æ–¥—É
            playerAttackBtn.classList.add('opacity-50', 'cursor-not-allowed');
            submitPhraseBtn.classList.add('opacity-50', 'cursor-not-allowed');

            bossHP -= playerAttackDamage; // –ó–Ω—ñ–º–∞—î–º–æ 25 HP
            if (bossHP < 0) bossHP = 0; // –ó–∞–ø–æ–±—ñ–≥–∞—î–º–æ –≤—ñ–¥'—î–º–Ω–æ–º—É HP
            updateBossHPDisplay();
            successSound();

            // –ë–æ—Å –∫–æ–Ω—Ç—Ä–∞—Ç–∞–∫—É—î, —è–∫—â–æ –π–æ–≥–æ HP > 0 –ø—ñ—Å–ª—è –∞—Ç–∞–∫–∏ –≥—Ä–∞–≤—Ü—è
            if (bossHP > 0) {
                setTimeout(bossAttack, 1000); // –ó–∞—Ç—Ä–∏–º–∫–∞ 1 —Å–µ–∫—É–Ω–¥–∞ –ø–µ—Ä–µ–¥ –∞—Ç–∞–∫–æ—é –±–æ—Å–∞
            } else {
                // –Ø–∫—â–æ –±–æ—Å –ø–æ–º–µ—Ä –≤—ñ–¥ –∞—Ç–∞–∫–∏, –¥–æ–∑–≤–æ–ª—è—î–º–æ –≤–≤–µ—Å—Ç–∏ —Ñ—Ä–∞–∑—É (–∞–±–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –ø–µ—Ä–µ–º–æ–≥–∏)
                finalInput.disabled = false;
                submitPhraseBtn.disabled = false;
                finalInput.placeholder = "–í–≤–µ–¥–∏ –ø–µ—Ä–µ–º–æ–∂–Ω—É —Ñ—Ä–∞–∑—É!";
                submitPhraseBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                playerAttackBtn.classList.add('opacity-50', 'cursor-not-allowed'); // –î–µ–∞–∫—Ç–∏–≤—É—î–º–æ –∫–Ω–æ–ø–∫—É –∞—Ç–∞–∫–∏
                winSound(); // –ú–æ–∂–ª–∏–≤–æ, –≤—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏ –∑–≤—É–∫ –ø–µ—Ä–µ–º–æ–≥–∏
                alert("–ë–æ—Å –ø–µ—Ä–µ–º–æ–∂–µ–Ω–∏–π! –í–≤–µ–¥—ñ—Ç—å –ø–µ—Ä–µ–º–æ–∂–Ω—É —Ñ—Ä–∞–∑—É, —â–æ–± –∑–∞–≤–µ—Ä—à–∏—Ç–∏!");
                backgroundMusic.pause(); // –ó—É–ø–∏–Ω—è—î–º–æ –º—É–∑–∏–∫—É –ø—ñ—Å–ª—è –ø–µ—Ä–µ–º–æ–≥–∏
                backgroundMusic.currentTime = 0;
            }
        }

        /**
         * –û–±—Ä–æ–±–ª—è—î –∞—Ç–∞–∫—É –±–æ—Å–∞.
         */
        function bossAttack() {
            failureSound(); // –ó–≤—É–∫ –∞—Ç–∞–∫–∏ –±–æ—Å–∞ (–º–æ–∂–Ω–∞ –∑–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ —ñ–Ω—à–∏–π)

            // –í–∏–±–∏—Ä–∞—î–º–æ –Ω–∞—Å—Ç—É–ø–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∞—Ç–∞–∫–∏
            const attackImageUrl = bossAttackImages[currentBossAttackImageIndex];
            bossAttackOverlay.style.backgroundImage = `url('${attackImageUrl}')`;
            bossAttackOverlay.classList.add('active'); // –†–æ–±–∏–º–æ –æ–≤–µ—Ä–ª–µ–π –≤–∏–¥–∏–º–∏–º (opacity 1)

            // –ü–µ—Ä–µ–º–∏–∫–∞—î–º–æ –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –∞—Ç–∞–∫–∏
            currentBossAttackImageIndex = (currentBossAttackImageIndex + 1) % bossAttackImages.length;

            // –ß–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥–∏ (—á–∞—Å –≤–∏–¥–∏–º–æ—Å—Ç—ñ) –ø–æ—á–∏–Ω–∞—î–º–æ –∑–Ω–∏–∫–∞—Ç–∏
            setTimeout(() => {
                bossAttackOverlay.classList.remove('active'); // –ó–∞–ø—É—Å–∫–∞—î–º–æ –∞–Ω—ñ–º–∞—Ü—ñ—é –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è (opacity 0)
                // –ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –∞–Ω—ñ–º–∞—Ü—ñ—ó –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è (2 —Å–µ–∫—É–Ω–¥–∏),
                // —Ä–æ–±–∏–º–æ –æ–≤–µ—Ä–ª–µ–π –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–º –ø–æ–≤–Ω—ñ—Å—Ç—é —ñ –¥–æ–∑–≤–æ–ª—è—î–º–æ –≥—Ä–∞–≤—Ü–µ–≤—ñ –∞—Ç–∞–∫—É–≤–∞—Ç–∏, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
                setTimeout(() => {
                    // –Ø–∫—â–æ –±–æ—Å –≤—Å–µ —â–µ –∂–∏–≤–∏–π —ñ –Ω–µ –¥–æ—Å—è–≥ –ø–æ—Ä–æ–≥—É –ø–µ—Ä–µ–º–æ–∂–Ω–æ—ó —Ñ—Ä–∞–∑–∏, –¥–æ–∑–≤–æ–ª—è—î–º–æ –∞—Ç–∞–∫—É–≤–∞—Ç–∏
                    if (bossHP > winningPhraseThreshold) {
                        playerAttackBtn.disabled = false; // –ó–Ω–æ–≤—É –¥–æ–∑–≤–æ–ª—è—î–º–æ –≥—Ä–∞–≤—Ü–µ–≤—ñ –∞—Ç–∞–∫—É–≤–∞—Ç–∏
                        playerAttackBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    } else if (bossHP <= winningPhraseThreshold && bossHP > 0) {
                        // –Ø–∫—â–æ HP <= 25%, –∞–ª–µ —â–µ –Ω–µ 0, –¥–æ–∑–≤–æ–ª—è—î–º–æ –≤–≤–µ—Å—Ç–∏ —Ñ—Ä–∞–∑—É
                        finalInput.disabled = false;
                        submitPhraseBtn.disabled = false;
                        submitPhraseBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    } else if (bossHP <= 0) {
                        // –Ø–∫—â–æ –±–æ—Å –ø–æ–º–µ—Ä, –∑–∞–ª–∏—à–∞—î–º–æ –∫–Ω–æ–ø–∫–∏ –∞—Ç–∞–∫–∏ —Ç–∞ —Ñ—Ä–∞–∑–∏ –≤–∏–º–∫–Ω–µ–Ω–∏–º–∏
                        playerAttackBtn.classList.add('opacity-50', 'cursor-not-allowed');
                        submitPhraseBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    }
                }, 2000); // –¢–∞–π–º–∞—É—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Ç—Ä–∏–≤–∞–ª–æ—Å—Ç—ñ CSS transition (2s)
            }, 2000); // –ß–∞—Å, –ø—Ä–æ—Ç—è–≥–æ–º —è–∫–æ–≥–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∞—Ç–∞–∫–∏ –ø–æ–≤–Ω—ñ—Å—Ç—é –≤–∏–¥–∏–º–µ
        }


        // --- –û–ë–†–û–ë–ù–ò–ö–ò –ü–û–î–Ü–ô ---

        startMissionBtn.addEventListener('click', () => {
            clickSound();
            showScreen('map-screen');
            updateMap();
        });

        modalCloseBtn.addEventListener('click', () => {
            clickSound();
            modalContainer.classList.add('hidden');
            showScreen('map-screen'); // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ—Å—å –Ω–∞ –∫–∞—Ä—Ç—É, –º—É–∑–∏–∫–∞ –Ω–µ –±—É–¥–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏—Å—å
            updateMap();
        });

        // –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∞—Ç–∞–∫–∏ –≥—Ä–∞–≤—Ü—è
        playerAttackBtn.addEventListener('click', playerAttack);

        // –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è —Ñ–æ—Ä–º–∏ –≤–≤–µ–¥–µ–Ω–Ω—è –ø–µ—Ä–µ–º–æ–∂–Ω–æ—ó —Ñ—Ä–∞–∑–∏
        finalForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const finalAnswers = ["–≤–∏–π–¥–∏ –æ—Ç—Å—é–¥–∞, —Ä–æ–∑–±—ñ–π–Ω–∏–∫", "–≤–∏–π–¥–∏ –æ—Ç—Å—é–¥–∞ —Ä–æ–∑–±—ñ–π–Ω–∏–∫", "–≤—ñ–π–¥–∏ –æ—Ç—Å—é–¥–∞, —Ä–æ–∑–±—ñ–π–Ω–∏–∫!"];
            const userInput = finalInput.value.trim().toLowerCase();
            
            // –¢–µ–ø–µ—Ä —Ñ—Ä–∞–∑—É –º–æ–∂–Ω–∞ –≤–≤–æ–¥–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ HP <= winningPhraseThreshold
            if (bossHP > winningPhraseThreshold && bossHP > 0) {
                // –ó–∞—Ä–∞–Ω–æ –¥–ª—è –ø–µ—Ä–µ–º–æ–∂–Ω–æ—ó —Ñ—Ä–∞–∑–∏
                failureSound();
                finalInput.classList.add('animate-bounce', 'border-red-500');
                finalInput.placeholder = "–©–µ –∑–∞—Ä–∞–Ω–æ! –ê—Ç–∞–∫—É–π —â–µ!";
                setTimeout(() => {
                    finalInput.classList.remove('animate-bounce', 'border-red-500');
                    finalInput.placeholder = "–í–≤–µ–¥–∏ –ø–µ—Ä–µ–º–æ–∂–Ω—É —Ñ—Ä–∞–∑—É...";
                    finalInput.value = "";
                }, 1500);
                return; // –í–∏—Ö–æ–¥–∏–º–æ
            }

            // –Ø–∫—â–æ HP <= winningPhraseThreshold, –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ñ—Ä–∞–∑—É
            if (finalAnswers.includes(userInput)) {
                winSound();
                // –ü—Ä–∏–ø—É—Å–∫–∞—î–º–æ, —â–æ reward-screen —ñ—Å–Ω—É—î —ñ —î –µ–∫—Ä–∞–Ω–æ–º –ø–µ—Ä–µ–º–æ–≥–∏
                showScreen('reward-screen'); 
                // –í–∏–≤–æ–¥–∏–º–æ –ø—Ä–æ—Å—Ç–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, –æ—Å–∫—ñ–ª—å–∫–∏ –º–æ–¥–∞–ª—å–Ω—ñ –≤—ñ–∫–Ω–∞ –∑–∞–∫–æ–º–µ–Ω—Ç–æ–≤–∞–Ω—ñ
                alert("–ü–ï–†–ï–ú–û–ì–ê! –í—Å—Ä–∞—Ç–∏–π –ß–µ—Ä–≤'—è–∫ –≤–∏–≥–Ω–∞–Ω–∏–π!");
            } else {
                failureSound();
                finalInput.classList.add('animate-bounce', 'border-red-500');
                finalInput.placeholder = "–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û! –°–ø—Ä–æ–±—É–π —â–µ!";
                setTimeout(() => {
                    finalInput.classList.remove('animate-bounce', 'border-red-500');
                    finalInput.placeholder = "–í–≤–µ–¥–∏ –ø–µ—Ä–µ–º–æ–∂–Ω—É —Ñ—Ä–∞–∑—É...";
                    finalInput.value = "";
                }, 1500);
            }
        });

        galleryBtn.addEventListener('click', () => {
            clickSound();
            showScreen('gallery-screen');
        });
        
        backToRewardBtn.addEventListener('click', () => {
            clickSound();
            showScreen('reward-screen');
        });

        // –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è —Ä–µ–≥—É–ª—è—Ç–æ—Ä–∞ –≥—É—á–Ω–æ—Å—Ç—ñ
        volumeSlider.addEventListener('input', () => {
            backgroundMusic.volume = volumeSlider.value;
        });

        // --- –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø –ì–†–ò ---
        document.body.addEventListener('click', () => {
             Tone.start();
             // NEW: –ó–∞–ø—É—Å–∫–∞—î–º–æ –º—É–∑–∏–∫—É –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –∫–ª—ñ–∫—É
             if (backgroundMusic.paused) {
                 backgroundMusic.play().catch(e => console.error("Autoplay was prevented:", e));
             }
        }, { once: true });
        
        // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤—É –≥—É—á–Ω—ñ—Å—Ç—å –¥–ª—è –ø–æ–≤–∑—É–Ω–∫–∞ —Ç–∞ –º—É–∑–∏–∫–∏
        // –¶–µ –≤–∞–∂–ª–∏–≤–æ, —â–æ–± –ø–æ–≤–∑—É–Ω–æ–∫ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–≤ —Ñ–∞–∫—Ç–∏—á–Ω—ñ–π –≥—É—á–Ω–æ—Å—Ç—ñ, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –º—É–∑–∏–∫–∞ —â–µ –Ω–µ –≥—Ä–∞–ª–∞
        backgroundMusic.volume = volumeSlider.value; 

        // –ü–æ–∫–∞–∑—É—î–º–æ –µ–∫—Ä–∞–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        showScreen('loader-screen');
        startPrologue();
        // –û–Ω–æ–≤–ª—é—î–º–æ HP-–±–∞—Ä –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
        updateBossHPDisplay();
        // –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –ø–æ–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è —Ñ—Ä–∞–∑–∏ –≤–∏–º–∫–Ω–µ–Ω—ñ –Ω–∞ —Å—Ç–∞—Ä—Ç—ñ
        finalInput.disabled = true;
        submitPhraseBtn.disabled = true;
        submitPhraseBtn.classList.add('opacity-50', 'cursor-not-allowed');

    </script>
</body>
</html>
